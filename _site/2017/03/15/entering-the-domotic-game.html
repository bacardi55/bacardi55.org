<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Entering the domotic game</title>
  <meta name="description" content="Introduction">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://bacardi55.org/2017/03/15/entering-the-domotic-game.html">
  <link rel="alternate" type="application/rss+xml" title="Bacardi55&#39;s random notes" href="/feed.xml">

  

  <!-- Begin Jekyll SEO tag v2.1.0 -->
<title>Entering the domotic game - Bacardi55’s random notes</title>
<meta property="og:title" content="Entering the domotic game" />
<meta name="description" content="Introduction" />
<meta property="og:description" content="Introduction" />
<link rel="canonical" href="http://bacardi55.org/2017/03/15/entering-the-domotic-game.html" />
<meta property="og:url" content="http://bacardi55.org/2017/03/15/entering-the-domotic-game.html" />
<meta property="og:site_name" content="Bacardi55’s random notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-03-15T00:00:00+01:00" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Entering the domotic game",
"datePublished": "2017-03-15T00:00:00+01:00",
"description": "Introduction",
"url": "http://bacardi55.org/2017/03/15/entering-the-domotic-game.html"}</script>
<!-- End Jekyll SEO tag -->

</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">

    <a class="site-title" href="/">Bacardi55&#39;s random notes</a>

    <nav class="site-nav">
      <span class="menu-icon">
        <svg viewBox="0 0 18 15" width="18px" height="15px">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </span>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
          <a class="page-link" href="/archive.html">Archive</a>
          
        
          
        
          
          <a class="page-link" href="/kalliope.html">Kalliopé</a>
          
        
          
          <a class="page-link" href="/my-laptop-configuration-with-i3wm.html">i3wm config</a>
          
        
          
          <a class="page-link" href="/tags.html">Tags</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">
        Entering the domotic game
    </h1>
    
        <h2>and bringing Kalliope and Domoticz together</h2>
    
    <p class="post-meta"><time datetime="2017-03-15T00:00:00+01:00" itemprop="datePublished">Mar 15, 2017</time></p>
  </header>

  <!-- Tags -->
  
    <a href="/tags.html#kalliope" class="tag">kalliope</a>,
  
    <a href="/tags.html#home_automation" class="tag">home_automation</a>,
  
    <a href="/tags.html#domoticz" class="tag">domoticz</a>
  


  <div class="post-content" itemprop="articleBody">
    <h2 id="introduction">Introduction</h2>

<p>So far, most of the things I do with Kalliope could be considered as not really domitic (maybe more domogeek ^^).</p>

<p>Indeed, so far I use Kalliope to:</p>

<ul>
  <li>Get data from API (<a href="https://github.com/bacardi55/google-calendar">Google calendar</a>, <a href="https://github.com/bacardi55/kalliope-gmaps">Google Maps</a>, <a href="https://github.com/bacardi55/kalliope-uber">Uber</a>)</li>
  <li>Get <a href="https://github.com/kalliope-project/kalliope_neuron_rss_reader">RSS feeds</a> info (lequipe.fr mainly)</li>
  <li><a href="https://github.com/bacardi55/kalliope-web-scraper">Scrap web page</a> to get content (Google news, TV program, Cinema program, joke of the day, …)</li>
  <li>Get Kalliope to reminds things using <a href="https://github.com/bacardi55/kalliope-starter55/blob/master/script/reminder.py">a script</a> and the <a href="https://github.com/bacardi55/kalliope-repeat">repeat neuron</a></li>
  <li><a href="https://github.com/bacardi55/kalliope-mpd">Play music</a> via my <a href="http://mopidy.com/">mopidy</a> server</li>
  <li>Play video on my <a href="https://kodi.tv/">Kodi</a> server via <a href="https://github.com/bacardi55/kalliope-starter55/blob/master/script/find-episode.sh">a script</a></li>
</ul>

<p>The last 2 items could be considered as domotic, but I consider them as media management, but the line is grey :)</p>

<h2 id="domotic">Domotic</h2>

<h3 id="what-for">what for?</h3>

<p>Usage are legions and I don’t intend to describe all of them here, just the one I’m going to use. Bear in mind than I’m just starting so my knowledge is limited and the devices I have are not numerous :).</p>

<p>I have several ideas to start with, like managing internal sensors (temp, light, motion detector, …) or managing switches (Lamp, electric plug, …)</p>

<h3 id="how">How:</h3>

<h4 id="the-protocol-z-wave">The protocol: Z-wave</h4>

<p>But first, I needed to find the basic of all this: How to manage these devices from a central control point. I read online some documentation, about protocol and devices and finally end up choosing device compatible with the z-wave protocol, as there is the openzwave opensource lib that seems to work well. Main issue of Z-wave is that the company behind it are owner of the z-wave chip.</p>

<p>I let you read online additional info on z-wave if you wish, there are a lot about it.</p>

<h4 id="the-main-controller-domoticz">The main controller: <a href="https://domoticz.com/">Domoticz</a></h4>

<p>So I ended up buying a usb stick z-wave controller and a z-wave multi sensor (temp/hum, light, motion detection) to start poking at it. But I still needed an app to manage all the z-wave devices.</p>

<p>For this, 2 solutions:</p>

<ul>
  <li>Create a neuron that leverage the openzwave python library</li>
  <li>Use a tool that manage domotic devices</li>
</ul>

<p>I think that the simplest, yet most powerful approach was to choose the 2nd option, and choose a software that was exactly meant to manage domotic device. I could have choose several: <a href="https://www.jeedom.com">jeedom</a>, <a href="http://www.openhab.org/">openhab</a>, <a href="Home-Assistant.io">Home-Assistant.io</a>, …</p>

<p>I ended up choosing <a href="https://domoticz.com/">Domoticz</a>, very light and powerful app in C++ with a web app and a mobile app. It was very easy to install on an old rpiB+ and to setup my z-wave sensor.</p>

<p>It also provide <a href="https://www.domoticz.com/wiki/Domoticz_API/JSON_URL%27s#Retrieve_status_of_specific_device">APIs</a> to do a lot of actions so that kalliope could send action :)</p>

<p>APIs provide options to (non exhaustive, go to their doc page for full API endpoints):</p>

<ul>
  <li>Get device status (and value): Important for me to get metric from sensor</li>
  <li>Set on/off on device: I’ll soon have a zwave electrig plug, and I want to be able to switch it on and off via kalliope</li>
  <li>Get / Set scene/groups state: Scene and groups are option in domoticz to regroup devices together (group mean all device has same state (on or off) and group state can be change. Scene has only one state, but devices can have different states).</li>
</ul>

<p>That’s the main I’ll start poking at, in that order!</p>

<h4 id="kalliope-integration">Kalliope integration</h4>

<h5 id="pymoticz">Pymoticz</h5>

<p>I did find online an <a href="https://github.com/EirikAskheim/pymoticz/network">old python code</a> to manage domoticz. I also found a more recent fork of it <a href="https://github.com/wackoracoon/pymoticz">here</a> that worked well.</p>

<p>Only issue is that is was forcing the use of http and didn’t allow https. So I <a href="https://github.com/bacardi55/pymoticz">forked it</a> to add https support. There is <a href="https://github.com/wackoracoon/pymoticz/pull/1">pull request here</a> to merge it.</p>

<h5 id="kalliope-neuron">Kalliope Neuron</h5>

<p>As you would have guess, a neuron is coming up. You can find it in a draft mode <a href="https://github.com/bacardi55/kalliope-domoticz">on github</a>. For now, it is very limited but in development. It does include directly the pymoticz library so no manual addition needed there.</p>

<p>For now, you can only request data value from a device. So for example, I can retrieve the temperature and the light level from the sensor.</p>

<p><strong>Brain example</strong></p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td class="code"><pre><span class="nn">---</span>
  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">domoticz-get-temp-living-room"</span>
    <span class="s">signals</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">order</span><span class="pi">:</span> <span class="s2">"</span><span class="s">living</span><span class="nv"> </span><span class="s">room</span><span class="nv"> </span><span class="s">temperature"</span>
    <span class="s">neurons</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">domoticz</span><span class="pi">:</span>
          <span class="s">host</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
          <span class="s">action</span><span class="pi">:</span> <span class="s2">"</span><span class="s">get_device"</span>
          <span class="s">device</span><span class="pi">:</span> <span class="s2">"</span><span class="s">6"</span>
          <span class="s">ssl_verify</span><span class="pi">:</span> <span class="s2">"</span><span class="s">False"</span>
          <span class="s">say_template</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Living</span><span class="nv"> </span><span class="s">temperature</span><span class="nv"> </span><span class="s">is</span><span class="nv">  </span><span class="s">degrees</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">humidity</span><span class="nv"> </span><span class="s">is</span><span class="nv">  </span><span class="s">%"</span>
  <span class="pi">-</span> <span class="s">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">domoticz-get-lux-living-room"</span>
    <span class="s">signals</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">order</span><span class="pi">:</span> <span class="s2">"</span><span class="s">brightness</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">living</span><span class="nv"> </span><span class="s">room"</span>
    <span class="s">neurons</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">domoticz</span><span class="pi">:</span>
          <span class="s">host</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
          <span class="s">action</span><span class="pi">:</span> <span class="s2">"</span><span class="s">get_device"</span>
          <span class="s">device</span><span class="pi">:</span> <span class="s2">"</span><span class="s">5"</span>
          <span class="s">ssl_verify</span><span class="pi">:</span> <span class="s2">"</span><span class="s">False"</span>
          <span class="s">say_template</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Living</span><span class="nv"> </span><span class="s">room</span><span class="nv"> </span><span class="s">brightness</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">"</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>

<h2 id="whats-next">What’s next</h2>

<p>As I said above, there are a lot to be able to do: set on/off devices, get / set scenes and groups, … A lot of fun to have marrying Kalliopé and domoticz :)</p>

<p>Stay tuned!</p>

  </div>

  

  
    <div>
      <h3>Related Posts</h3>
      <ul>
        
          <li><a href="/2017/03/19/kalliop%C3%A9-what-time-is-it-in.html">Kalliopé, what time is it in …</a></li>
        
          <li><a href="/2017/03/16/managing-a-shopping-list-with-kalliope.html">Managing a shopping list with Kalliope</a></li>
        
          <li><a href="/2017/02/24/monitor-and-restart-kalliope-via-a-led-and-a-push-button.html">Monitor and restart Kalliope via a led and a push button</a></li>
        
          <li><a href="/2017/02/22/opening-tv-show-episode-via-kalliope.html">Opening Tv show episode via Kalliope</a></li>
        
          <li><a href="/2017/02/21/kalliope-a-poorsman-log-analyser.html">Kalliope - a poorsman log analyser</a></li>
        
      </ul>
    </div>
  

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Bacardi55&#39;s random notes</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              bacardi55
            
            </li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/bacardi55"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">bacardi55</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/bacardi555"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">bacardi555</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>This is a small place on the Internet where I talk about stuff…
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
